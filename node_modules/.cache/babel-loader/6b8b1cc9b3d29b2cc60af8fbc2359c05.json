{"ast":null,"code":"/**\n * Appointment-Picker - a lightweight, accessible and customizable timepicker (ES5 syntax)\n *\n * @module Appointment-Picker\n * @license MIT\n * @version 2.0.0\n * @author Jan Suwart\n*/\n(function (root, factory) {\n  if (typeof exports === 'object') {\n    module.exports = factory(root); // CommonJS (Node, Browserify, Webpack)\n  } else if (typeof define === 'function' && define.amd) {\n    define('appointment-picker', [], function () {\n      return factory(root); // AMD (RequireJS)\n    });\n  } else {\n    root.AppointmentPicker = factory(root); // Browser globals (root = window)\n  }\n})(this, function () {\n  'use strict';\n  /**\n   * Constructor\n   * @param {HTMLElement} el - reference to the time input field\n   * @param {Object} options - user defined options\n   */\n\n  var AppointmentPicker = function (el, options) {\n    this.options = {\n      interval: 60,\n      // Appointment interval in minutes\n      minTime: 0,\n      // min pickable hour (1-24)\n      maxTime: 24,\n      // max pickable hour (1-24)\n      startTime: 0,\n      // min displayed hour (1-24)\n      endTime: 24,\n      // max displayed hour (1-24)\n      disabled: [],\n      // Array of disabled times, i.e. ['10:30', ...]\n      mode: '24h',\n      // Whether to use 24h or 12h system\n      large: false,\n      // Whether large button style\n      leadingZero: false,\n      // Whether to zero pad hour (i.e. 07:15)\n      allowReset: true,\n      // Whether a time can be reset once entered\n      title: 'Timepicker',\n      // Title\n      templateInner: '<li class=\"appo-picker-list-item {{disabled}}\"><input type=\"button\" tabindex=\"-1\" value=\"{{time}}\" {{disabled}}></li>',\n      templateOuter: '<span class=\"appo-picker-title\">{{title}}</span><ul class=\"appo-picker-list\">{{innerHtml}}</ul>',\n      timeFormat12: 'H:M apm',\n      // Custom time format, must contain H and M placeholder\n      timeFormat24: 'H:M'\n    };\n    this.el = el;\n    this.picker = null;\n    this.isOpen = false;\n    this.isInDom = false;\n    this.time = {}; // { h: '18', m: '30' }\n\n    this.intervals = []; // [0, 15, 30, 45]\n\n    this.disabledArr = [];\n    this.displayTime = ''; // '6:30pm'\n\n    this.selectionEventFn = _onselect.bind(this);\n    this.changeEventFn = _onchange.bind(this);\n    this.clickEventFn = _onInputClick.bind(this);\n    this.closeEventFn = this.close.bind(this);\n    this.openEventFn = this.open.bind(this);\n    this.keyEventFn = _onKeyPress.bind(this);\n    this.bodyFocusEventFn = _onBodyFocus.bind(this);\n    initialize(this, el, options || {});\n  };\n  /**\n   * Initialize the picker, merge default options and check for errors\n   * @param {Object} _this - this view reference\n   * @param {HTMLElement} el - reference to the time input field\n   * @param {Object} options - user defined options\n   */\n\n\n  function initialize(_this, el, options) {\n    for (var opt in options) {\n      _this.options[opt] = options[opt];\n    }\n\n    if (!_this.el) return;\n\n    if (_this.el.length !== undefined) {\n      console.warn('appointment-picker: pass only one dom element as argument');\n      return;\n    } else if (_this.options.interval > 60) {\n      console.warn('appointment-picker: the maximal interval is 60');\n      return;\n    } // Create 2-dim array holding all disabled times\n\n\n    _this.disabledArr = _this.options.disabled.map(function (item) {\n      return _parseTime(item);\n    }); // Create array holding all minute permutations\n\n    for (var j = 0; j < 60 / _this.options.interval; j++) {\n      _this.intervals[j] = j * _this.options.interval;\n    }\n\n    _this.setTime(_this.el.value);\n\n    el.addEventListener('keyup', _this.keyEventFn);\n    el.addEventListener('change', _this.changeEventFn);\n    el.addEventListener('focus', _this.openEventFn);\n  } // Attach visibility classes and set the picker's position\n\n\n  AppointmentPicker.prototype.render = function () {\n    if (this.isOpen && this.isInDom) {\n      var bottom = this.el.offsetTop + this.el.offsetHeight;\n      var left = this.el.offsetLeft;\n      var oldSelectedEl = this.picker.querySelector('input.is-selected');\n      this.picker.classList.add('is-open');\n      this.el.classList.add('is-expanded');\n\n      if (oldSelectedEl) {\n        oldSelectedEl.classList.remove('is-selected');\n      }\n\n      if (this.time.hasOwnProperty('h')) {\n        var selectedEl = this.picker.querySelector('[value=\"' + this.displayTime + '\"]');\n\n        if (selectedEl) {\n          selectedEl.classList.add('is-selected');\n        }\n      }\n\n      this.picker.style.top = bottom + 'px';\n      this.picker.style.left = left + 'px';\n    } else if (this.isInDom) {\n      this.picker.classList.remove('is-open');\n      this.el.classList.remove('is-expanded');\n    }\n  }; // Opens the picker, registers further click events\n\n\n  AppointmentPicker.prototype.open = function () {\n    var _this = this;\n\n    if (this.isOpen) return;\n\n    if (!this.isInDom) {\n      this.picker = _build(_this);\n      this.isInDom = true;\n    }\n\n    this.isOpen = true;\n    this.render();\n    this.picker.addEventListener('click', this.selectionEventFn);\n    this.picker.addEventListener('keyup', this.keyEventFn);\n    this.el.removeEventListener('click', this.clickEventFn);\n\n    _dispatchEvent(this.el, 'open', this.time, this.displayTime); // Delay document click listener to prevent picker flashing\n\n\n    setTimeout(function () {\n      document.body.addEventListener('click', _this.closeEventFn);\n      document.body.addEventListener('focus', _this.bodyFocusEventFn, true);\n    }, 100);\n  };\n  /**\n   * Close the picker and unregister attached events\n   * @param {Event|null} e - i.e. mouse click event\n   */\n\n\n  AppointmentPicker.prototype.close = function (e) {\n    if (!this.isOpen) return; // Polyfil matches selector if missing\n\n    if (!Element.prototype.matches) Element.prototype.matches = Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector;\n\n    if (e) {\n      var el = e.target;\n      if (el.isEqualNode(this.el)) return; // Check if the clicked target is inside the picker\n\n      while (el) {\n        if (el.matches('.appo-picker')) {\n          return;\n        } else {\n          el = el.parentElement;\n        }\n      }\n    } // The target was outside or didn't exist, close picker\n\n\n    this.isOpen = false;\n    this.render();\n    this.picker.removeEventListener('click', this.selectionEventFn);\n    this.picker.removeEventListener('keyup', this.keyEventFn);\n    document.body.removeEventListener('click', this.closeEventFn);\n    document.body.removeEventListener('focus', this.bodyFocusEventFn, true); // Add an event listener to open on click regardless of mouse focus\n\n    this.el.addEventListener('click', this.clickEventFn);\n\n    _dispatchEvent(this.el, 'close', this.time, this.displayTime);\n  };\n  /**\n   * Listener for an appointment selection\n   * @param {Event} e - mouse click or keyboard event\n   */\n\n\n  function _onselect(e) {\n    var _this = this;\n\n    if (!e.target.value) return;\n    this.setTime(e.target.value);\n    this.el.focus();\n    setTimeout(function () {\n      _this.close(null);\n    }, 100);\n  } // Handles manual input changes on input field\n\n\n  function _onchange() {\n    this.setTime(this.el.value);\n  }\n  /**\n   * Move focus forward and backward on keyboard arrow key, close picker on ESC\n   * @param {Event} e - keyboard event\n   */\n\n\n  function _onKeyPress(e) {\n    var first = this.picker.querySelector('input[type=\"button\"]:not([disabled])');\n    var selected = this.picker.querySelector('input.is-selected');\n    var next = null;\n\n    switch (e.keyCode) {\n      case 13: // Enter\n\n      case 27:\n        // ESC\n        this.close(null);\n        break;\n\n      case 38:\n        // Up Arrow\n        next = selected ? _getNextSibling(selected.parentNode, -1) : first.parentNode;\n        break;\n\n      case 40:\n        // Down Arrow\n        next = selected ? _getNextSibling(selected.parentNode, 1) : first.parentNode;\n        break;\n\n      default:\n    }\n\n    if (next && !next.firstChild.disabled) {\n      next.firstChild.classList.add('is-selected');\n      if (selected) selected.classList.remove('is-selected');\n      this.setTime(next.firstChild.value);\n    }\n  } // Close the picker on document focus, usually by hitting TAB\n\n\n  function _onBodyFocus(e) {\n    if (!this.isOpen) return;\n    this.close(e);\n  } // Opens the picker, useful if the input has focus, still to be able to open the picker\n\n\n  function _onInputClick() {\n    this.open();\n  } // Remove the picker's node from the dom and unregister all events\n\n\n  AppointmentPicker.prototype.destroy = function () {\n    this.close(null);\n\n    if (this.picker) {\n      this.picker.parentNode.removeChild(this.picker);\n      this.picker = null;\n    }\n\n    this.el.removeEventListener('focus', this.openEventFn);\n    this.el.removeEventListener('keyup', this.keyEventFn);\n    this.el.removeEventListener('change', this.changeEventFn);\n    this.el.removeEventListener('click', this.clickEventFn);\n  };\n  /**\n   * Sets the pickers current time variable after validating for min/max\n   * @param {String} value - time input string, i.e. '12:15pm'\n   */\n\n\n  AppointmentPicker.prototype.setTime = function (value) {\n    var time = _parseTime(value);\n\n    var is24h = this.options.mode === '24h';\n    var timePattern = is24h ? this.options.timeFormat24 : this.options.timeFormat12;\n\n    if (!time && !value && this.options.allowReset) {\n      // Empty string, reset time\n      this.time = {};\n      this.displayTime = '';\n\n      _dispatchEvent(this.el, 'change', this.time, this.displayTime);\n    } else if (time) {\n      // A time format was recognized\n      var hour = time.h;\n      var minute = time.m;\n\n      var isValid = _isValid(hour, minute, this.options, this.intervals, this.disabledArr);\n\n      var pad0 = this.options.leadingZero;\n\n      if (isValid) {\n        this.time = time;\n        this.displayTime = _printTime(this.time.h, this.time.m, timePattern, !is24h, pad0);\n\n        _dispatchEvent(this.el, 'change', this.time, this.displayTime);\n      }\n    }\n\n    this.render();\n    this.el.value = this.displayTime;\n  }; // Time getter returns time as object\n\n\n  AppointmentPicker.prototype.getTime = function () {\n    return {\n      h: this.time.h,\n      m: this.time.m,\n      displayTime: this.displayTime\n    };\n  };\n  /**\n   * Checks validity using defined constraints\n   * @returns {Boolean} true if valid\n   */\n\n\n  function _isValid(hour, minute, opt, intervals, disabledArr) {\n    var inDisabledArr = false;\n\n    if (hour < opt.minTime || hour > opt.maxTime || hour > 24) {\n      // Out of min/max\n      return false;\n    } else if (hour === opt.maxTime && minute > 0) {\n      return false; // h:[interval] is out of max\n    } else if (intervals.indexOf(minute) < 0) {\n      // Min doesn't match any interval\n      return false;\n    }\n\n    disabledArr.forEach(function (item, i) {\n      // h:m combination in disabled array\n      if (item.h === hour && item.m === minute) inDisabledArr = true;\n    });\n    return !inDisabledArr ? true : false; // All valid\n  }\n  /**\n   * Add a leading zero and convert to string\n   * @param {Number} number - number that needs to be padded\n   * @returns {String} i.e. '05'\n   */\n\n\n  function _zeroPadTime(number) {\n    if (/^[0-9]{1}$/.test(number)) return '0' + number;\n    return number;\n  }\n  /**\n   * @param {String} time - string that needs to be parsed, i.e. '11:15PM ' or '10:30 am'\n   * @returns {Object|undefined} containing {h: hour, m: minute} or undefined if unrecognized\n   * @see https://regexr.com/4c8fo\n   */\n\n\n  function _parseTime(time) {\n    if (!time) return;\n    var match = time.match(/^\\s*([\\d]{1,2})\\D?([\\d]{2})\\W?(a|p)?.*$/i);\n\n    if (match) {\n      var hour = Number(match[1]);\n      var minute = Number(match[2]);\n      var postfix = match[3];\n\n      if (/p/i.test(postfix) && hour !== 12) {\n        hour += 12;\n      } else if (/a/i.test(postfix) && hour === 12) {\n        hour = 0;\n      }\n\n      return {\n        h: hour,\n        m: minute\n      };\n    }\n  }\n  /**\n   * Create time considering am/pm conventions\n   * @param {Number} hour\n   * @param {Number} minute\n   * @param {String} pattern - used time format\n   * @param {Boolean} isAmPmMode - false if 24h mode\n   * @param {Boolean} padZero - adds leading zero to single-digit hour\n   * @return {String} time string, i.e. '12:30 pm'\n   */\n\n\n  function _printTime(hour, minute, pattern, isAmPmMode, padZero) {\n    var displayHour = hour;\n\n    if (isAmPmMode) {\n      if (hour > 12) {\n        displayHour = hour - 12;\n      } else if (hour == 0) {\n        displayHour = 12;\n      }\n\n      pattern = pattern.replace(hour < 12 ? /p/i : /a/i, '');\n    }\n\n    return pattern.replace('H', padZero ? _zeroPadTime(displayHour) : displayHour).replace('M', _zeroPadTime(minute));\n  } // Find next sibling of item that is not disabled (otherwise return null)\n\n\n  function _getNextSibling(item, direction) {\n    if (!item) return null; // Break condition for recursion\n\n    var next = direction < 0 ? item.previousElementSibling : item.nextElementSibling;\n\n    if (next && next.className.indexOf('disabled') < 0) {\n      return next;\n    } else {\n      // If disabled class found, try the next sibling\n      return _getNextSibling(next, direction);\n    }\n  } // Create a dom node containing the markup for the picker\n\n\n  function _build(_this) {\n    var node = document.createElement('div');\n    node.innerHTML = _assemblePicker(_this.options, _this.intervals, _this.disabledArr);\n    node.className = 'appo-picker' + (_this.options.large ? ' is-large' : '');\n    node.setAttribute('aria-hidden', true);\n\n    _this.el.insertAdjacentElement('afterend', node);\n\n    return node;\n  }\n  /**\n   * Assemble the html containing each appointment represented by a button\n   * @param {Object} opt - options object\n   * @param {Array} intervals - array holding interval permutations\n   * @param {Array} disabledArr - array holding disabled times\n   */\n\n\n  function _assemblePicker(opt, intervals, disabledArr) {\n    // _this.options, _this.intervals, _this.disabledArr\n    var start = opt.startTime;\n    var end = opt.endTime;\n    var inner = '';\n    var isAmPmMode = opt.mode === '12h';\n    var timePattern = isAmPmMode ? opt.timeFormat12 : opt.timeFormat24;\n\n    for (var hour = start; hour < end; hour++) {\n      // Iterate hours start to end\n      for (var j = 0; j < intervals.length; j++) {\n        // Iterate minutes by possible intervals\n        var minute = intervals[j];\n        var isDisabled = !_isValid(hour, minute, opt, intervals, disabledArr);\n\n        var timeFormat = _printTime(hour, minute, timePattern, isAmPmMode, opt.leadingZero); // Replace timeFormat placeholders with time and disabled flag\n\n\n        inner += opt.templateInner.replace('{{time}}', timeFormat).replace(/{{disabled}}/ig, isDisabled ? 'disabled' : '');\n      }\n    }\n\n    return opt.templateOuter.replace('{{classes}}', opt.large ? 'is-large' : '').replace('{{title}}', opt.title).replace('{{innerHtml}}', inner);\n  }\n  /**\n   * Creates and triggers an event with attached time property\n   * @param {HTMLElement} el - element reference\n   * @param {String} name - event name\n   * @param {Object} time - current time\n   */\n\n\n  function _dispatchEvent(el, name, time, displayTime) {\n    var event = document.createEvent('Event');\n    event.initEvent(name + '.appo.picker', true, true);\n    event.time = time;\n    event.displayTime = displayTime;\n    el.dispatchEvent(event);\n  }\n\n  return AppointmentPicker;\n});","map":{"version":3,"sources":["/Users/heather/Development/code/nomad/node_modules/appointment-picker/src/appointment-picker.js"],"names":["root","factory","exports","module","define","amd","AppointmentPicker","el","options","interval","minTime","maxTime","startTime","endTime","disabled","mode","large","leadingZero","allowReset","title","templateInner","templateOuter","timeFormat12","timeFormat24","picker","isOpen","isInDom","time","intervals","disabledArr","displayTime","selectionEventFn","_onselect","bind","changeEventFn","_onchange","clickEventFn","_onInputClick","closeEventFn","close","openEventFn","open","keyEventFn","_onKeyPress","bodyFocusEventFn","_onBodyFocus","initialize","_this","opt","length","undefined","console","warn","map","item","_parseTime","j","setTime","value","addEventListener","prototype","render","bottom","offsetTop","offsetHeight","left","offsetLeft","oldSelectedEl","querySelector","classList","add","remove","hasOwnProperty","selectedEl","style","top","_build","removeEventListener","_dispatchEvent","setTimeout","document","body","e","Element","matches","msMatchesSelector","webkitMatchesSelector","target","isEqualNode","parentElement","focus","first","selected","next","keyCode","_getNextSibling","parentNode","firstChild","destroy","removeChild","is24h","timePattern","hour","h","minute","m","isValid","_isValid","pad0","_printTime","getTime","inDisabledArr","indexOf","forEach","i","_zeroPadTime","number","test","match","Number","postfix","pattern","isAmPmMode","padZero","displayHour","replace","direction","previousElementSibling","nextElementSibling","className","node","createElement","innerHTML","_assemblePicker","setAttribute","insertAdjacentElement","start","end","inner","isDisabled","timeFormat","name","event","createEvent","initEvent","dispatchEvent"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACC,WAAUA,IAAV,EAAgBC,OAAhB,EAAyB;AACzB,MAAI,OAAOC,OAAP,KAAmB,QAAvB,EAAiC;AAChCC,IAAAA,MAAM,CAACD,OAAP,GAAiBD,OAAO,CAACD,IAAD,CAAxB,CADgC,CACA;AAChC,GAFD,MAEO,IAAI,OAAOI,MAAP,KAAkB,UAAlB,IAAgCA,MAAM,CAACC,GAA3C,EAAgD;AACtDD,IAAAA,MAAM,CAAC,oBAAD,EAAuB,EAAvB,EAA2B,YAAY;AAC5C,aAAOH,OAAO,CAACD,IAAD,CAAd,CAD4C,CACtB;AACtB,KAFK,CAAN;AAGA,GAJM,MAIA;AACNA,IAAAA,IAAI,CAACM,iBAAL,GAAyBL,OAAO,CAACD,IAAD,CAAhC,CADM,CACkC;AACxC;AACD,CAVA,EAUC,IAVD,EAUO,YAAW;AAClB;AAEA;AACD;AACA;AACA;AACA;;AACC,MAAIM,iBAAiB,GAAG,UAASC,EAAT,EAAaC,OAAb,EAAsB;AAC7C,SAAKA,OAAL,GAAe;AACdC,MAAAA,QAAQ,EAAE,EADI;AACA;AACdC,MAAAA,OAAO,EAAE,CAFK;AAEF;AACZC,MAAAA,OAAO,EAAE,EAHK;AAGD;AACbC,MAAAA,SAAS,EAAE,CAJG;AAIA;AACdC,MAAAA,OAAO,EAAE,EALK;AAKD;AACbC,MAAAA,QAAQ,EAAE,EANI;AAMA;AACdC,MAAAA,IAAI,EAAE,KAPQ;AAOD;AACbC,MAAAA,KAAK,EAAE,KARO;AAQA;AACdC,MAAAA,WAAW,EAAE,KATC;AASM;AACpBC,MAAAA,UAAU,EAAE,IAVE;AAUI;AAClBC,MAAAA,KAAK,EAAE,YAXO;AAWO;AACrBC,MAAAA,aAAa,EAAE,uHAZD;AAadC,MAAAA,aAAa,EAAE,iGAbD;AAcdC,MAAAA,YAAY,EAAE,SAdA;AAcW;AACzBC,MAAAA,YAAY,EAAE;AAfA,KAAf;AAkBA,SAAKhB,EAAL,GAAUA,EAAV;AACA,SAAKiB,MAAL,GAAc,IAAd;AACA,SAAKC,MAAL,GAAc,KAAd;AACA,SAAKC,OAAL,GAAe,KAAf;AACA,SAAKC,IAAL,GAAY,EAAZ,CAvB6C,CAuB7B;;AAChB,SAAKC,SAAL,GAAiB,EAAjB,CAxB6C,CAwBxB;;AACrB,SAAKC,WAAL,GAAmB,EAAnB;AACA,SAAKC,WAAL,GAAmB,EAAnB,CA1B6C,CA0BtB;;AACvB,SAAKC,gBAAL,GAAwBC,SAAS,CAACC,IAAV,CAAe,IAAf,CAAxB;AACA,SAAKC,aAAL,GAAqBC,SAAS,CAACF,IAAV,CAAe,IAAf,CAArB;AACA,SAAKG,YAAL,GAAoBC,aAAa,CAACJ,IAAd,CAAmB,IAAnB,CAApB;AACA,SAAKK,YAAL,GAAoB,KAAKC,KAAL,CAAWN,IAAX,CAAgB,IAAhB,CAApB;AACA,SAAKO,WAAL,GAAmB,KAAKC,IAAL,CAAUR,IAAV,CAAe,IAAf,CAAnB;AACA,SAAKS,UAAL,GAAkBC,WAAW,CAACV,IAAZ,CAAiB,IAAjB,CAAlB;AACA,SAAKW,gBAAL,GAAwBC,YAAY,CAACZ,IAAb,CAAkB,IAAlB,CAAxB;AAEAa,IAAAA,UAAU,CAAC,IAAD,EAAOvC,EAAP,EAAWC,OAAO,IAAI,EAAtB,CAAV;AACA,GApCD;AAsCA;AACD;AACA;AACA;AACA;AACA;;;AACC,WAASsC,UAAT,CAAoBC,KAApB,EAA2BxC,EAA3B,EAA+BC,OAA/B,EAAwC;AACvC,SAAK,IAAIwC,GAAT,IAAgBxC,OAAhB,EAAyB;AACxBuC,MAAAA,KAAK,CAACvC,OAAN,CAAcwC,GAAd,IAAqBxC,OAAO,CAACwC,GAAD,CAA5B;AACA;;AACD,QAAI,CAACD,KAAK,CAACxC,EAAX,EAAe;;AAEf,QAAIwC,KAAK,CAACxC,EAAN,CAAS0C,MAAT,KAAoBC,SAAxB,EAAmC;AAClCC,MAAAA,OAAO,CAACC,IAAR,CAAa,2DAAb;AACA;AACA,KAHD,MAGO,IAAIL,KAAK,CAACvC,OAAN,CAAcC,QAAd,GAAyB,EAA7B,EAAiC;AACvC0C,MAAAA,OAAO,CAACC,IAAR,CAAa,gDAAb;AACA;AACA,KAZsC,CAavC;;;AACAL,IAAAA,KAAK,CAAClB,WAAN,GAAoBkB,KAAK,CAACvC,OAAN,CAAcM,QAAd,CAAuBuC,GAAvB,CAA2B,UAASC,IAAT,EAAe;AAC7D,aAAOC,UAAU,CAACD,IAAD,CAAjB;AACA,KAFmB,CAApB,CAduC,CAkBvC;;AACA,SAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKT,KAAK,CAACvC,OAAN,CAAcC,QAAvC,EAAiD+C,CAAC,EAAlD,EAAsD;AACrDT,MAAAA,KAAK,CAACnB,SAAN,CAAgB4B,CAAhB,IAAqBA,CAAC,GAAGT,KAAK,CAACvC,OAAN,CAAcC,QAAvC;AACA;;AAEDsC,IAAAA,KAAK,CAACU,OAAN,CAAcV,KAAK,CAACxC,EAAN,CAASmD,KAAvB;;AACAnD,IAAAA,EAAE,CAACoD,gBAAH,CAAoB,OAApB,EAA6BZ,KAAK,CAACL,UAAnC;AACAnC,IAAAA,EAAE,CAACoD,gBAAH,CAAoB,QAApB,EAA8BZ,KAAK,CAACb,aAApC;AACA3B,IAAAA,EAAE,CAACoD,gBAAH,CAAoB,OAApB,EAA6BZ,KAAK,CAACP,WAAnC;AACA,GA/EiB,CAiFlB;;;AACAlC,EAAAA,iBAAiB,CAACsD,SAAlB,CAA4BC,MAA5B,GAAqC,YAAW;AAC/C,QAAI,KAAKpC,MAAL,IAAe,KAAKC,OAAxB,EAAiC;AAChC,UAAIoC,MAAM,GAAG,KAAKvD,EAAL,CAAQwD,SAAR,GAAoB,KAAKxD,EAAL,CAAQyD,YAAzC;AACA,UAAIC,IAAI,GAAG,KAAK1D,EAAL,CAAQ2D,UAAnB;AACA,UAAIC,aAAa,GAAG,KAAK3C,MAAL,CAAY4C,aAAZ,CAA0B,mBAA1B,CAApB;AAEA,WAAK5C,MAAL,CAAY6C,SAAZ,CAAsBC,GAAtB,CAA0B,SAA1B;AACA,WAAK/D,EAAL,CAAQ8D,SAAR,CAAkBC,GAAlB,CAAsB,aAAtB;;AAEA,UAAIH,aAAJ,EAAmB;AAClBA,QAAAA,aAAa,CAACE,SAAd,CAAwBE,MAAxB,CAA+B,aAA/B;AACA;;AACD,UAAI,KAAK5C,IAAL,CAAU6C,cAAV,CAAyB,GAAzB,CAAJ,EAAmC;AAClC,YAAIC,UAAU,GAAG,KAAKjD,MAAL,CAAY4C,aAAZ,CAA0B,aAAa,KAAKtC,WAAlB,GAAgC,IAA1D,CAAjB;;AAEA,YAAI2C,UAAJ,EAAgB;AACfA,UAAAA,UAAU,CAACJ,SAAX,CAAqBC,GAArB,CAAyB,aAAzB;AACA;AACD;;AACD,WAAK9C,MAAL,CAAYkD,KAAZ,CAAkBC,GAAlB,GAAwBb,MAAM,GAAG,IAAjC;AACA,WAAKtC,MAAL,CAAYkD,KAAZ,CAAkBT,IAAlB,GAAyBA,IAAI,GAAG,IAAhC;AACA,KApBD,MAoBO,IAAI,KAAKvC,OAAT,EAAkB;AACxB,WAAKF,MAAL,CAAY6C,SAAZ,CAAsBE,MAAtB,CAA6B,SAA7B;AACA,WAAKhE,EAAL,CAAQ8D,SAAR,CAAkBE,MAAlB,CAAyB,aAAzB;AACA;AACD,GAzBD,CAlFkB,CA6GlB;;;AACAjE,EAAAA,iBAAiB,CAACsD,SAAlB,CAA4BnB,IAA5B,GAAmC,YAAW;AAC7C,QAAIM,KAAK,GAAG,IAAZ;;AAEA,QAAI,KAAKtB,MAAT,EAAiB;;AAEjB,QAAI,CAAC,KAAKC,OAAV,EAAmB;AAClB,WAAKF,MAAL,GAAcoD,MAAM,CAAC7B,KAAD,CAApB;AACA,WAAKrB,OAAL,GAAe,IAAf;AACA;;AAED,SAAKD,MAAL,GAAc,IAAd;AACA,SAAKoC,MAAL;AACA,SAAKrC,MAAL,CAAYmC,gBAAZ,CAA6B,OAA7B,EAAsC,KAAK5B,gBAA3C;AACA,SAAKP,MAAL,CAAYmC,gBAAZ,CAA6B,OAA7B,EAAsC,KAAKjB,UAA3C;AACA,SAAKnC,EAAL,CAAQsE,mBAAR,CAA4B,OAA5B,EAAqC,KAAKzC,YAA1C;;AAEA0C,IAAAA,cAAc,CAAC,KAAKvE,EAAN,EAAU,MAAV,EAAkB,KAAKoB,IAAvB,EAA6B,KAAKG,WAAlC,CAAd,CAhB6C,CAkB7C;;;AACAiD,IAAAA,UAAU,CAAC,YAAW;AACrBC,MAAAA,QAAQ,CAACC,IAAT,CAActB,gBAAd,CAA+B,OAA/B,EAAwCZ,KAAK,CAACT,YAA9C;AACA0C,MAAAA,QAAQ,CAACC,IAAT,CAActB,gBAAd,CAA+B,OAA/B,EAAwCZ,KAAK,CAACH,gBAA9C,EAAgE,IAAhE;AACA,KAHS,EAGP,GAHO,CAAV;AAIA,GAvBD;AAyBA;AACD;AACA;AACA;;;AACCtC,EAAAA,iBAAiB,CAACsD,SAAlB,CAA4BrB,KAA5B,GAAoC,UAAS2C,CAAT,EAAY;AAC/C,QAAI,CAAC,KAAKzD,MAAV,EAAkB,OAD6B,CAG/C;;AACA,QAAI,CAAC0D,OAAO,CAACvB,SAAR,CAAkBwB,OAAvB,EACCD,OAAO,CAACvB,SAAR,CAAkBwB,OAAlB,GAA4BD,OAAO,CAACvB,SAAR,CAAkByB,iBAAlB,IAC3BF,OAAO,CAACvB,SAAR,CAAkB0B,qBADnB;;AAED,QAAIJ,CAAJ,EAAO;AACN,UAAI3E,EAAE,GAAG2E,CAAC,CAACK,MAAX;AACA,UAAIhF,EAAE,CAACiF,WAAH,CAAe,KAAKjF,EAApB,CAAJ,EAA6B,OAFvB,CAGN;;AACA,aAAOA,EAAP,EAAW;AACV,YAAIA,EAAE,CAAC6E,OAAH,CAAW,cAAX,CAAJ,EAAgC;AAC/B;AACA,SAFD,MAEO;AACN7E,UAAAA,EAAE,GAAGA,EAAE,CAACkF,aAAR;AACA;AACD;AACD,KAlB8C,CAmB/C;;;AACA,SAAKhE,MAAL,GAAc,KAAd;AACA,SAAKoC,MAAL;AAEA,SAAKrC,MAAL,CAAYqD,mBAAZ,CAAgC,OAAhC,EAAyC,KAAK9C,gBAA9C;AACA,SAAKP,MAAL,CAAYqD,mBAAZ,CAAgC,OAAhC,EAAyC,KAAKnC,UAA9C;AACAsC,IAAAA,QAAQ,CAACC,IAAT,CAAcJ,mBAAd,CAAkC,OAAlC,EAA2C,KAAKvC,YAAhD;AACA0C,IAAAA,QAAQ,CAACC,IAAT,CAAcJ,mBAAd,CAAkC,OAAlC,EAA2C,KAAKjC,gBAAhD,EAAkE,IAAlE,EA1B+C,CA2B/C;;AACA,SAAKrC,EAAL,CAAQoD,gBAAR,CAAyB,OAAzB,EAAkC,KAAKvB,YAAvC;;AAEA0C,IAAAA,cAAc,CAAC,KAAKvE,EAAN,EAAU,OAAV,EAAmB,KAAKoB,IAAxB,EAA8B,KAAKG,WAAnC,CAAd;AACA,GA/BD;AAiCA;AACD;AACA;AACA;;;AACC,WAASE,SAAT,CAAmBkD,CAAnB,EAAsB;AACrB,QAAInC,KAAK,GAAG,IAAZ;;AACA,QAAI,CAACmC,CAAC,CAACK,MAAF,CAAS7B,KAAd,EAAqB;AAErB,SAAKD,OAAL,CAAayB,CAAC,CAACK,MAAF,CAAS7B,KAAtB;AACA,SAAKnD,EAAL,CAAQmF,KAAR;AACAX,IAAAA,UAAU,CAAC,YAAW;AAAEhC,MAAAA,KAAK,CAACR,KAAN,CAAY,IAAZ;AAAoB,KAAlC,EAAoC,GAApC,CAAV;AACA,GAvLiB,CAyLlB;;;AACA,WAASJ,SAAT,GAAqB;AACpB,SAAKsB,OAAL,CAAa,KAAKlD,EAAL,CAAQmD,KAArB;AACA;AAED;AACD;AACA;AACA;;;AACC,WAASf,WAAT,CAAqBuC,CAArB,EAAwB;AACvB,QAAIS,KAAK,GAAG,KAAKnE,MAAL,CAAY4C,aAAZ,CAA0B,sCAA1B,CAAZ;AACA,QAAIwB,QAAQ,GAAG,KAAKpE,MAAL,CAAY4C,aAAZ,CAA0B,mBAA1B,CAAf;AACA,QAAIyB,IAAI,GAAG,IAAX;;AAEA,YAAQX,CAAC,CAACY,OAAV;AACC,WAAK,EAAL,CADD,CACU;;AACT,WAAK,EAAL;AAAS;AACR,aAAKvD,KAAL,CAAW,IAAX;AACA;;AACD,WAAK,EAAL;AAAS;AACRsD,QAAAA,IAAI,GAAGD,QAAQ,GAAGG,eAAe,CAACH,QAAQ,CAACI,UAAV,EAAsB,CAAC,CAAvB,CAAlB,GAA8CL,KAAK,CAACK,UAAnE;AACA;;AACD,WAAK,EAAL;AAAS;AACRH,QAAAA,IAAI,GAAGD,QAAQ,GAAGG,eAAe,CAACH,QAAQ,CAACI,UAAV,EAAsB,CAAtB,CAAlB,GAA6CL,KAAK,CAACK,UAAlE;AACA;;AACD;AAXD;;AAcA,QAAIH,IAAI,IAAI,CAACA,IAAI,CAACI,UAAL,CAAgBnF,QAA7B,EAAuC;AACtC+E,MAAAA,IAAI,CAACI,UAAL,CAAgB5B,SAAhB,CAA0BC,GAA1B,CAA8B,aAA9B;AACA,UAAIsB,QAAJ,EACCA,QAAQ,CAACvB,SAAT,CAAmBE,MAAnB,CAA0B,aAA1B;AACD,WAAKd,OAAL,CAAaoC,IAAI,CAACI,UAAL,CAAgBvC,KAA7B;AACA;AACD,GA3NiB,CA6NlB;;;AACA,WAASb,YAAT,CAAsBqC,CAAtB,EAAyB;AACxB,QAAI,CAAC,KAAKzD,MAAV,EAAkB;AAClB,SAAKc,KAAL,CAAW2C,CAAX;AACA,GAjOiB,CAmOlB;;;AACA,WAAS7C,aAAT,GAAyB;AACxB,SAAKI,IAAL;AACA,GAtOiB,CAwOlB;;;AACAnC,EAAAA,iBAAiB,CAACsD,SAAlB,CAA4BsC,OAA5B,GAAsC,YAAW;AAChD,SAAK3D,KAAL,CAAW,IAAX;;AAEA,QAAI,KAAKf,MAAT,EAAiB;AAChB,WAAKA,MAAL,CAAYwE,UAAZ,CAAuBG,WAAvB,CAAmC,KAAK3E,MAAxC;AACA,WAAKA,MAAL,GAAc,IAAd;AACA;;AACD,SAAKjB,EAAL,CAAQsE,mBAAR,CAA4B,OAA5B,EAAqC,KAAKrC,WAA1C;AACA,SAAKjC,EAAL,CAAQsE,mBAAR,CAA4B,OAA5B,EAAqC,KAAKnC,UAA1C;AACA,SAAKnC,EAAL,CAAQsE,mBAAR,CAA4B,QAA5B,EAAsC,KAAK3C,aAA3C;AACA,SAAK3B,EAAL,CAAQsE,mBAAR,CAA4B,OAA5B,EAAqC,KAAKzC,YAA1C;AACA,GAXD;AAaA;AACD;AACA;AACA;;;AACC9B,EAAAA,iBAAiB,CAACsD,SAAlB,CAA4BH,OAA5B,GAAsC,UAASC,KAAT,EAAgB;AACrD,QAAI/B,IAAI,GAAG4B,UAAU,CAACG,KAAD,CAArB;;AACA,QAAI0C,KAAK,GAAG,KAAK5F,OAAL,CAAaO,IAAb,KAAsB,KAAlC;AACA,QAAIsF,WAAW,GAAGD,KAAK,GAAG,KAAK5F,OAAL,CAAae,YAAhB,GAA+B,KAAKf,OAAL,CAAac,YAAnE;;AAEA,QAAI,CAACK,IAAD,IAAS,CAAC+B,KAAV,IAAmB,KAAKlD,OAAL,CAAaU,UAApC,EAAgD;AAAE;AACjD,WAAKS,IAAL,GAAY,EAAZ;AACA,WAAKG,WAAL,GAAmB,EAAnB;;AACAgD,MAAAA,cAAc,CAAC,KAAKvE,EAAN,EAAU,QAAV,EAAoB,KAAKoB,IAAzB,EAA+B,KAAKG,WAApC,CAAd;AACA,KAJD,MAIO,IAAIH,IAAJ,EAAU;AAAE;AAClB,UAAI2E,IAAI,GAAG3E,IAAI,CAAC4E,CAAhB;AACA,UAAIC,MAAM,GAAG7E,IAAI,CAAC8E,CAAlB;;AACA,UAAIC,OAAO,GAAGC,QAAQ,CAACL,IAAD,EAAOE,MAAP,EAAe,KAAKhG,OAApB,EAA6B,KAAKoB,SAAlC,EAA6C,KAAKC,WAAlD,CAAtB;;AACA,UAAI+E,IAAI,GAAG,KAAKpG,OAAL,CAAaS,WAAxB;;AAEA,UAAIyF,OAAJ,EAAa;AACZ,aAAK/E,IAAL,GAAYA,IAAZ;AACA,aAAKG,WAAL,GAAmB+E,UAAU,CAAC,KAAKlF,IAAL,CAAU4E,CAAX,EAAc,KAAK5E,IAAL,CAAU8E,CAAxB,EAA2BJ,WAA3B,EAAwC,CAACD,KAAzC,EAAgDQ,IAAhD,CAA7B;;AACA9B,QAAAA,cAAc,CAAC,KAAKvE,EAAN,EAAU,QAAV,EAAoB,KAAKoB,IAAzB,EAA+B,KAAKG,WAApC,CAAd;AACA;AACD;;AACD,SAAK+B,MAAL;AACA,SAAKtD,EAAL,CAAQmD,KAAR,GAAgB,KAAK5B,WAArB;AACA,GAvBD,CA1PkB,CAmRlB;;;AACAxB,EAAAA,iBAAiB,CAACsD,SAAlB,CAA4BkD,OAA5B,GAAsC,YAAW;AAChD,WAAO;AAAEP,MAAAA,CAAC,EAAE,KAAK5E,IAAL,CAAU4E,CAAf;AAAkBE,MAAAA,CAAC,EAAE,KAAK9E,IAAL,CAAU8E,CAA/B;AAAkC3E,MAAAA,WAAW,EAAE,KAAKA;AAApD,KAAP;AACA,GAFD;AAIA;AACD;AACA;AACA;;;AACC,WAAS6E,QAAT,CAAkBL,IAAlB,EAAwBE,MAAxB,EAAgCxD,GAAhC,EAAqCpB,SAArC,EAAgDC,WAAhD,EAA6D;AAC5D,QAAIkF,aAAa,GAAG,KAApB;;AACA,QAAIT,IAAI,GAAGtD,GAAG,CAACtC,OAAX,IAAsB4F,IAAI,GAAGtD,GAAG,CAACrC,OAAjC,IAA4C2F,IAAI,GAAG,EAAvD,EAA2D;AAAE;AAC5D,aAAO,KAAP;AACA,KAFD,MAEO,IAAIA,IAAI,KAAKtD,GAAG,CAACrC,OAAb,IAAwB6F,MAAM,GAAG,CAArC,EAAwC;AAC9C,aAAO,KAAP,CAD8C,CAChC;AACd,KAFM,MAEA,IAAI5E,SAAS,CAACoF,OAAV,CAAkBR,MAAlB,IAA4B,CAAhC,EAAmC;AAAE;AAC3C,aAAO,KAAP;AACA;;AACD3E,IAAAA,WAAW,CAACoF,OAAZ,CAAoB,UAAS3D,IAAT,EAAe4D,CAAf,EAAkB;AAAE;AACvC,UAAI5D,IAAI,CAACiD,CAAL,KAAWD,IAAX,IAAmBhD,IAAI,CAACmD,CAAL,KAAWD,MAAlC,EACCO,aAAa,GAAG,IAAhB;AACD,KAHD;AAKA,WAAO,CAACA,aAAD,GAAiB,IAAjB,GAAwB,KAA/B,CAd4D,CActB;AACtC;AAED;AACD;AACA;AACA;AACA;;;AACC,WAASI,YAAT,CAAsBC,MAAtB,EAA8B;AAC7B,QAAI,aAAaC,IAAb,CAAkBD,MAAlB,CAAJ,EACC,OAAO,MAAMA,MAAb;AACD,WAAOA,MAAP;AACA;AAED;AACD;AACA;AACA;AACA;;;AACC,WAAS7D,UAAT,CAAoB5B,IAApB,EAA0B;AACzB,QAAI,CAACA,IAAL,EAAW;AACX,QAAI2F,KAAK,GAAG3F,IAAI,CAAC2F,KAAL,CAAW,0CAAX,CAAZ;;AAEA,QAAIA,KAAJ,EAAW;AACV,UAAIhB,IAAI,GAAGiB,MAAM,CAACD,KAAK,CAAC,CAAD,CAAN,CAAjB;AACA,UAAId,MAAM,GAAGe,MAAM,CAACD,KAAK,CAAC,CAAD,CAAN,CAAnB;AACA,UAAIE,OAAO,GAAGF,KAAK,CAAC,CAAD,CAAnB;;AAEA,UAAI,KAAKD,IAAL,CAAUG,OAAV,KAAsBlB,IAAI,KAAK,EAAnC,EAAuC;AACtCA,QAAAA,IAAI,IAAI,EAAR;AACA,OAFD,MAEO,IAAI,KAAKe,IAAL,CAAUG,OAAV,KAAsBlB,IAAI,KAAK,EAAnC,EAAuC;AAC7CA,QAAAA,IAAI,GAAG,CAAP;AACA;;AAED,aAAO;AAAEC,QAAAA,CAAC,EAAED,IAAL;AAAWG,QAAAA,CAAC,EAAED;AAAd,OAAP;AACA;AACD;AAED;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACC,WAASK,UAAT,CAAoBP,IAApB,EAA0BE,MAA1B,EAAkCiB,OAAlC,EAA2CC,UAA3C,EAAuDC,OAAvD,EAAgE;AAC/D,QAAIC,WAAW,GAAGtB,IAAlB;;AAEA,QAAIoB,UAAJ,EAAgB;AACf,UAAIpB,IAAI,GAAG,EAAX,EAAe;AACdsB,QAAAA,WAAW,GAAGtB,IAAI,GAAG,EAArB;AACA,OAFD,MAEO,IAAIA,IAAI,IAAI,CAAZ,EAAe;AACrBsB,QAAAA,WAAW,GAAG,EAAd;AACA;;AACDH,MAAAA,OAAO,GAAGA,OAAO,CAACI,OAAR,CAAgBvB,IAAI,GAAG,EAAP,GAAY,IAAZ,GAAmB,IAAnC,EAAyC,EAAzC,CAAV;AACA;;AAED,WAAOmB,OAAO,CACZI,OADK,CACG,GADH,EACQF,OAAO,GAAGR,YAAY,CAACS,WAAD,CAAf,GAA+BA,WAD9C,EAELC,OAFK,CAEG,GAFH,EAEQV,YAAY,CAACX,MAAD,CAFpB,CAAP;AAGA,GAxWiB,CA0WlB;;;AACA,WAAST,eAAT,CAAyBzC,IAAzB,EAA+BwE,SAA/B,EAA0C;AACzC,QAAI,CAACxE,IAAL,EAAW,OAAO,IAAP,CAD8B,CACjB;;AAExB,QAAIuC,IAAI,GAAGiC,SAAS,GAAG,CAAZ,GAAgBxE,IAAI,CAACyE,sBAArB,GAA8CzE,IAAI,CAAC0E,kBAA9D;;AACA,QAAInC,IAAI,IAAIA,IAAI,CAACoC,SAAL,CAAejB,OAAf,CAAuB,UAAvB,IAAqC,CAAjD,EAAoD;AACnD,aAAOnB,IAAP;AACA,KAFD,MAEO;AAAE;AACR,aAAOE,eAAe,CAACF,IAAD,EAAOiC,SAAP,CAAtB;AACA;AACD,GApXiB,CAsXlB;;;AACA,WAASlD,MAAT,CAAgB7B,KAAhB,EAAuB;AACtB,QAAImF,IAAI,GAAGlD,QAAQ,CAACmD,aAAT,CAAuB,KAAvB,CAAX;AACAD,IAAAA,IAAI,CAACE,SAAL,GAAiBC,eAAe,CAACtF,KAAK,CAACvC,OAAP,EAAgBuC,KAAK,CAACnB,SAAtB,EAAiCmB,KAAK,CAAClB,WAAvC,CAAhC;AACAqG,IAAAA,IAAI,CAACD,SAAL,GAAkB,iBAAiBlF,KAAK,CAACvC,OAAN,CAAcQ,KAAd,GAAsB,WAAtB,GAAoC,EAArD,CAAlB;AACAkH,IAAAA,IAAI,CAACI,YAAL,CAAkB,aAAlB,EAAiC,IAAjC;;AACAvF,IAAAA,KAAK,CAACxC,EAAN,CAASgI,qBAAT,CAA+B,UAA/B,EAA2CL,IAA3C;;AAEA,WAAOA,IAAP;AACA;AAED;AACD;AACA;AACA;AACA;AACA;;;AACC,WAASG,eAAT,CAAyBrF,GAAzB,EAA8BpB,SAA9B,EAAyCC,WAAzC,EAAsD;AACrD;AACA,QAAI2G,KAAK,GAAGxF,GAAG,CAACpC,SAAhB;AACA,QAAI6H,GAAG,GAAGzF,GAAG,CAACnC,OAAd;AACA,QAAI6H,KAAK,GAAG,EAAZ;AACA,QAAIhB,UAAU,GAAG1E,GAAG,CAACjC,IAAJ,KAAa,KAA9B;AACA,QAAIsF,WAAW,GAAGqB,UAAU,GAAG1E,GAAG,CAAC1B,YAAP,GAAsB0B,GAAG,CAACzB,YAAtD;;AAEA,SAAK,IAAI+E,IAAI,GAAGkC,KAAhB,EAAuBlC,IAAI,GAAGmC,GAA9B,EAAmCnC,IAAI,EAAvC,EAA2C;AAAE;AAC5C,WAAK,IAAI9C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG5B,SAAS,CAACqB,MAA9B,EAAsCO,CAAC,EAAvC,EAA2C;AAAE;AAC5C,YAAIgD,MAAM,GAAG5E,SAAS,CAAC4B,CAAD,CAAtB;AACA,YAAImF,UAAU,GAAG,CAAChC,QAAQ,CAACL,IAAD,EAAOE,MAAP,EAAexD,GAAf,EAAoBpB,SAApB,EAA+BC,WAA/B,CAA1B;;AACA,YAAI+G,UAAU,GAAG/B,UAAU,CAACP,IAAD,EAAOE,MAAP,EAAeH,WAAf,EAA4BqB,UAA5B,EAAwC1E,GAAG,CAAC/B,WAA5C,CAA3B,CAH0C,CAI1C;;;AACAyH,QAAAA,KAAK,IAAI1F,GAAG,CAAC5B,aAAJ,CACPyG,OADO,CACC,UADD,EACae,UADb,EAEPf,OAFO,CAEC,gBAFD,EAEmBc,UAAU,GAAG,UAAH,GAAe,EAF5C,CAAT;AAGA;AACD;;AAED,WAAO3F,GAAG,CAAC3B,aAAJ,CACLwG,OADK,CACG,aADH,EACkB7E,GAAG,CAAChC,KAAJ,GAAY,UAAZ,GAAwB,EAD1C,EAEL6G,OAFK,CAEG,WAFH,EAEgB7E,GAAG,CAAC7B,KAFpB,EAGL0G,OAHK,CAGG,eAHH,EAGoBa,KAHpB,CAAP;AAIA;AAED;AACD;AACA;AACA;AACA;AACA;;;AACC,WAAS5D,cAAT,CAAwBvE,EAAxB,EAA4BsI,IAA5B,EAAkClH,IAAlC,EAAwCG,WAAxC,EAAqD;AACpD,QAAIgH,KAAK,GAAG9D,QAAQ,CAAC+D,WAAT,CAAqB,OAArB,CAAZ;AACAD,IAAAA,KAAK,CAACE,SAAN,CAAgBH,IAAI,GAAG,cAAvB,EAAuC,IAAvC,EAA6C,IAA7C;AACAC,IAAAA,KAAK,CAACnH,IAAN,GAAaA,IAAb;AACAmH,IAAAA,KAAK,CAAChH,WAAN,GAAoBA,WAApB;AACAvB,IAAAA,EAAE,CAAC0I,aAAH,CAAiBH,KAAjB;AACA;;AAED,SAAOxI,iBAAP;AACA,CA1bA,CAAD","sourcesContent":["/**\n * Appointment-Picker - a lightweight, accessible and customizable timepicker (ES5 syntax)\n *\n * @module Appointment-Picker\n * @license MIT\n * @version 2.0.0\n * @author Jan Suwart\n*/\n(function (root, factory) {\n\tif (typeof exports === 'object') {\n\t\tmodule.exports = factory(root); // CommonJS (Node, Browserify, Webpack)\n\t} else if (typeof define === 'function' && define.amd) {\n\t\tdefine('appointment-picker', [], function () {\n\t\t\treturn factory(root); // AMD (RequireJS)\n\t\t});\n\t} else {\n\t\troot.AppointmentPicker = factory(root); // Browser globals (root = window)\n\t}\n}(this, function() {\n\t'use strict';\n\n\t/**\n\t * Constructor\n\t * @param {HTMLElement} el - reference to the time input field\n\t * @param {Object} options - user defined options\n\t */\n\tvar AppointmentPicker = function(el, options) {\n\t\tthis.options = {\n\t\t\tinterval: 60, // Appointment interval in minutes\n\t\t\tminTime: 0, // min pickable hour (1-24)\n\t\t\tmaxTime: 24, // max pickable hour (1-24)\n\t\t\tstartTime: 0, // min displayed hour (1-24)\n\t\t\tendTime: 24, // max displayed hour (1-24)\n\t\t\tdisabled: [], // Array of disabled times, i.e. ['10:30', ...]\n\t\t\tmode: '24h', // Whether to use 24h or 12h system\n\t\t\tlarge: false, // Whether large button style\n\t\t\tleadingZero: false, // Whether to zero pad hour (i.e. 07:15)\n\t\t\tallowReset: true, // Whether a time can be reset once entered\n\t\t\ttitle: 'Timepicker', // Title\n\t\t\ttemplateInner: '<li class=\"appo-picker-list-item {{disabled}}\"><input type=\"button\" tabindex=\"-1\" value=\"{{time}}\" {{disabled}}></li>',\n\t\t\ttemplateOuter: '<span class=\"appo-picker-title\">{{title}}</span><ul class=\"appo-picker-list\">{{innerHtml}}</ul>',\n\t\t\ttimeFormat12: 'H:M apm', // Custom time format, must contain H and M placeholder\n\t\t\ttimeFormat24: 'H:M'\n\t\t};\n\n\t\tthis.el = el;\n\t\tthis.picker = null;\n\t\tthis.isOpen = false;\n\t\tthis.isInDom = false;\n\t\tthis.time = {}; // { h: '18', m: '30' }\n\t\tthis.intervals = []; // [0, 15, 30, 45]\n\t\tthis.disabledArr = [];\n\t\tthis.displayTime = ''; // '6:30pm'\n\t\tthis.selectionEventFn = _onselect.bind(this);\n\t\tthis.changeEventFn = _onchange.bind(this);\n\t\tthis.clickEventFn = _onInputClick.bind(this);\n\t\tthis.closeEventFn = this.close.bind(this);\n\t\tthis.openEventFn = this.open.bind(this);\n\t\tthis.keyEventFn = _onKeyPress.bind(this);\n\t\tthis.bodyFocusEventFn = _onBodyFocus.bind(this);\n\n\t\tinitialize(this, el, options || {});\n\t};\n\n\t/**\n\t * Initialize the picker, merge default options and check for errors\n\t * @param {Object} _this - this view reference\n\t * @param {HTMLElement} el - reference to the time input field\n\t * @param {Object} options - user defined options\n\t */\n\tfunction initialize(_this, el, options) {\n\t\tfor (var opt in options) {\n\t\t\t_this.options[opt] = options[opt];\n\t\t}\n\t\tif (!_this.el) return;\n\n\t\tif (_this.el.length !== undefined) {\n\t\t\tconsole.warn('appointment-picker: pass only one dom element as argument');\n\t\t\treturn;\n\t\t} else if (_this.options.interval > 60) {\n\t\t\tconsole.warn('appointment-picker: the maximal interval is 60');\n\t\t\treturn;\n\t\t}\n\t\t// Create 2-dim array holding all disabled times\n\t\t_this.disabledArr = _this.options.disabled.map(function(item) {\n\t\t\treturn _parseTime(item);\n\t\t});\n\n\t\t// Create array holding all minute permutations\n\t\tfor (var j = 0; j < 60 / _this.options.interval; j++) {\n\t\t\t_this.intervals[j] = j * _this.options.interval;\n\t\t}\n\n\t\t_this.setTime(_this.el.value);\n\t\tel.addEventListener('keyup', _this.keyEventFn);\n\t\tel.addEventListener('change', _this.changeEventFn);\n\t\tel.addEventListener('focus', _this.openEventFn);\n\t}\n\n\t// Attach visibility classes and set the picker's position\n\tAppointmentPicker.prototype.render = function() {\n\t\tif (this.isOpen && this.isInDom) {\n\t\t\tvar bottom = this.el.offsetTop + this.el.offsetHeight;\n\t\t\tvar left = this.el.offsetLeft;\n\t\t\tvar oldSelectedEl = this.picker.querySelector('input.is-selected');\n\n\t\t\tthis.picker.classList.add('is-open');\n\t\t\tthis.el.classList.add('is-expanded');\n\n\t\t\tif (oldSelectedEl) {\n\t\t\t\toldSelectedEl.classList.remove('is-selected');\n\t\t\t}\n\t\t\tif (this.time.hasOwnProperty('h')) {\n\t\t\t\tvar selectedEl = this.picker.querySelector('[value=\"' + this.displayTime + '\"]');\n\n\t\t\t\tif (selectedEl) {\n\t\t\t\t\tselectedEl.classList.add('is-selected');\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.picker.style.top = bottom + 'px';\n\t\t\tthis.picker.style.left = left + 'px';\n\t\t} else if (this.isInDom) {\n\t\t\tthis.picker.classList.remove('is-open');\n\t\t\tthis.el.classList.remove('is-expanded');\n\t\t}\n\t};\n\n\t// Opens the picker, registers further click events\n\tAppointmentPicker.prototype.open = function() {\n\t\tvar _this = this;\n\n\t\tif (this.isOpen) return;\n\n\t\tif (!this.isInDom) {\n\t\t\tthis.picker = _build(_this);\n\t\t\tthis.isInDom = true;\n\t\t}\n\n\t\tthis.isOpen = true;\n\t\tthis.render();\n\t\tthis.picker.addEventListener('click', this.selectionEventFn);\n\t\tthis.picker.addEventListener('keyup', this.keyEventFn);\n\t\tthis.el.removeEventListener('click', this.clickEventFn);\n\n\t\t_dispatchEvent(this.el, 'open', this.time, this.displayTime);\n\n\t\t// Delay document click listener to prevent picker flashing\n\t\tsetTimeout(function() {\n\t\t\tdocument.body.addEventListener('click', _this.closeEventFn);\n\t\t\tdocument.body.addEventListener('focus', _this.bodyFocusEventFn, true);\n\t\t}, 100);\n\t};\n\n\t/**\n\t * Close the picker and unregister attached events\n\t * @param {Event|null} e - i.e. mouse click event\n\t */\n\tAppointmentPicker.prototype.close = function(e) {\n\t\tif (!this.isOpen) return;\n\n\t\t// Polyfil matches selector if missing\n\t\tif (!Element.prototype.matches)\n\t\t\tElement.prototype.matches = Element.prototype.msMatchesSelector ||\n\t\t\t\tElement.prototype.webkitMatchesSelector;\n\t\tif (e) {\n\t\t\tvar el = e.target;\n\t\t\tif (el.isEqualNode(this.el)) return;\n\t\t\t// Check if the clicked target is inside the picker\n\t\t\twhile (el) {\n\t\t\t\tif (el.matches('.appo-picker')) {\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\tel = el.parentElement;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// The target was outside or didn't exist, close picker\n\t\tthis.isOpen = false;\n\t\tthis.render();\n\n\t\tthis.picker.removeEventListener('click', this.selectionEventFn);\n\t\tthis.picker.removeEventListener('keyup', this.keyEventFn);\n\t\tdocument.body.removeEventListener('click', this.closeEventFn);\n\t\tdocument.body.removeEventListener('focus', this.bodyFocusEventFn, true);\n\t\t// Add an event listener to open on click regardless of mouse focus\n\t\tthis.el.addEventListener('click', this.clickEventFn);\n\n\t\t_dispatchEvent(this.el, 'close', this.time, this.displayTime);\n\t};\n\n\t/**\n\t * Listener for an appointment selection\n\t * @param {Event} e - mouse click or keyboard event\n\t */\n\tfunction _onselect(e) {\n\t\tvar _this = this;\n\t\tif (!e.target.value) return;\n\n\t\tthis.setTime(e.target.value);\n\t\tthis.el.focus();\n\t\tsetTimeout(function() { _this.close(null); }, 100);\n\t}\n\n\t// Handles manual input changes on input field\n\tfunction _onchange() {\n\t\tthis.setTime(this.el.value);\n\t}\n\n\t/**\n\t * Move focus forward and backward on keyboard arrow key, close picker on ESC\n\t * @param {Event} e - keyboard event\n\t */\n\tfunction _onKeyPress(e) {\n\t\tvar first = this.picker.querySelector('input[type=\"button\"]:not([disabled])');\n\t\tvar selected = this.picker.querySelector('input.is-selected');\n\t\tvar next = null;\n\n\t\tswitch (e.keyCode) {\n\t\t\tcase 13: // Enter\n\t\t\tcase 27: // ESC\n\t\t\t\tthis.close(null);\n\t\t\t\tbreak;\n\t\t\tcase 38: // Up Arrow\n\t\t\t\tnext = selected ? _getNextSibling(selected.parentNode, -1) : first.parentNode;\n\t\t\t\tbreak;\n\t\t\tcase 40: // Down Arrow\n\t\t\t\tnext = selected ? _getNextSibling(selected.parentNode, 1) : first.parentNode;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t}\n\n\t\tif (next && !next.firstChild.disabled) {\n\t\t\tnext.firstChild.classList.add('is-selected');\n\t\t\tif (selected)\n\t\t\t\tselected.classList.remove('is-selected');\n\t\t\tthis.setTime(next.firstChild.value);\n\t\t}\n\t}\n\n\t// Close the picker on document focus, usually by hitting TAB\n\tfunction _onBodyFocus(e) {\n\t\tif (!this.isOpen) return;\n\t\tthis.close(e);\n\t}\n\n\t// Opens the picker, useful if the input has focus, still to be able to open the picker\n\tfunction _onInputClick() {\n\t\tthis.open();\n\t}\n\n\t// Remove the picker's node from the dom and unregister all events\n\tAppointmentPicker.prototype.destroy = function() {\n\t\tthis.close(null);\n\n\t\tif (this.picker) {\n\t\t\tthis.picker.parentNode.removeChild(this.picker);\n\t\t\tthis.picker = null;\n\t\t}\n\t\tthis.el.removeEventListener('focus', this.openEventFn);\n\t\tthis.el.removeEventListener('keyup', this.keyEventFn);\n\t\tthis.el.removeEventListener('change', this.changeEventFn);\n\t\tthis.el.removeEventListener('click', this.clickEventFn);\n\t};\n\n\t/**\n\t * Sets the pickers current time variable after validating for min/max\n\t * @param {String} value - time input string, i.e. '12:15pm'\n\t */\n\tAppointmentPicker.prototype.setTime = function(value) {\n\t\tvar time = _parseTime(value);\n\t\tvar is24h = this.options.mode === '24h';\n\t\tvar timePattern = is24h ? this.options.timeFormat24 : this.options.timeFormat12;\n\n\t\tif (!time && !value && this.options.allowReset) { // Empty string, reset time\n\t\t\tthis.time = {};\n\t\t\tthis.displayTime = '';\n\t\t\t_dispatchEvent(this.el, 'change', this.time, this.displayTime);\n\t\t} else if (time) { // A time format was recognized\n\t\t\tvar hour = time.h;\n\t\t\tvar minute = time.m;\n\t\t\tvar isValid = _isValid(hour, minute, this.options, this.intervals, this.disabledArr);\n\t\t\tvar pad0 = this.options.leadingZero;\n\n\t\t\tif (isValid) {\n\t\t\t\tthis.time = time;\n\t\t\t\tthis.displayTime = _printTime(this.time.h, this.time.m, timePattern, !is24h, pad0);\n\t\t\t\t_dispatchEvent(this.el, 'change', this.time, this.displayTime);\n\t\t\t}\n\t\t}\n\t\tthis.render();\n\t\tthis.el.value = this.displayTime;\n\t};\n\n\t// Time getter returns time as object\n\tAppointmentPicker.prototype.getTime = function() {\n\t\treturn { h: this.time.h, m: this.time.m, displayTime: this.displayTime };\n\t};\n\n\t/**\n\t * Checks validity using defined constraints\n\t * @returns {Boolean} true if valid\n\t */\n\tfunction _isValid(hour, minute, opt, intervals, disabledArr) {\n\t\tvar inDisabledArr = false;\n\t\tif (hour < opt.minTime || hour > opt.maxTime || hour > 24) { // Out of min/max\n\t\t\treturn false;\n\t\t} else if (hour === opt.maxTime && minute > 0) {\n\t\t\treturn false; // h:[interval] is out of max\n\t\t} else if (intervals.indexOf(minute) < 0) { // Min doesn't match any interval\n\t\t\treturn false;\n\t\t}\n\t\tdisabledArr.forEach(function(item, i) { // h:m combination in disabled array\n\t\t\tif (item.h === hour && item.m === minute)\n\t\t\t\tinDisabledArr = true;\n\t\t});\n\n\t\treturn !inDisabledArr ? true : false; // All valid\n\t}\n\n\t/**\n\t * Add a leading zero and convert to string\n\t * @param {Number} number - number that needs to be padded\n\t * @returns {String} i.e. '05'\n\t */\n\tfunction _zeroPadTime(number) {\n\t\tif (/^[0-9]{1}$/.test(number))\n\t\t\treturn '0' + number;\n\t\treturn number;\n\t}\n\n\t/**\n\t * @param {String} time - string that needs to be parsed, i.e. '11:15PM ' or '10:30 am'\n\t * @returns {Object|undefined} containing {h: hour, m: minute} or undefined if unrecognized\n\t * @see https://regexr.com/4c8fo\n\t */\n\tfunction _parseTime(time) {\n\t\tif (!time) return;\n\t\tvar match = time.match(/^\\s*([\\d]{1,2})\\D?([\\d]{2})\\W?(a|p)?.*$/i);\n\n\t\tif (match) {\n\t\t\tvar hour = Number(match[1]);\n\t\t\tvar minute = Number(match[2]);\n\t\t\tvar postfix = match[3];\n\n\t\t\tif (/p/i.test(postfix) && hour !== 12) {\n\t\t\t\thour += 12;\n\t\t\t} else if (/a/i.test(postfix) && hour === 12) {\n\t\t\t\thour = 0;\n\t\t\t}\n\n\t\t\treturn { h: hour, m: minute };\n\t\t}\n\t}\n\n\t/**\n\t * Create time considering am/pm conventions\n\t * @param {Number} hour\n\t * @param {Number} minute\n\t * @param {String} pattern - used time format\n\t * @param {Boolean} isAmPmMode - false if 24h mode\n\t * @param {Boolean} padZero - adds leading zero to single-digit hour\n\t * @return {String} time string, i.e. '12:30 pm'\n\t */\n\tfunction _printTime(hour, minute, pattern, isAmPmMode, padZero) {\n\t\tvar displayHour = hour;\n\n\t\tif (isAmPmMode) {\n\t\t\tif (hour > 12) {\n\t\t\t\tdisplayHour = hour - 12;\n\t\t\t} else if (hour == 0) {\n\t\t\t\tdisplayHour = 12;\n\t\t\t}\n\t\t\tpattern = pattern.replace(hour < 12 ? /p/i : /a/i, '');\n\t\t}\n\n\t\treturn pattern\n\t\t\t.replace('H', padZero ? _zeroPadTime(displayHour) : displayHour)\n\t\t\t.replace('M', _zeroPadTime(minute));\n\t}\n\n\t// Find next sibling of item that is not disabled (otherwise return null)\n\tfunction _getNextSibling(item, direction) {\n\t\tif (!item) return null; // Break condition for recursion\n\n\t\tvar next = direction < 0 ? item.previousElementSibling : item.nextElementSibling;\n\t\tif (next && next.className.indexOf('disabled') < 0) {\n\t\t\treturn next;\n\t\t} else { // If disabled class found, try the next sibling\n\t\t\treturn _getNextSibling(next, direction);\n\t\t}\n\t}\n\n\t// Create a dom node containing the markup for the picker\n\tfunction _build(_this) {\n\t\tvar node = document.createElement('div');\n\t\tnode.innerHTML = _assemblePicker(_this.options, _this.intervals, _this.disabledArr);\n\t\tnode.className = ('appo-picker' + (_this.options.large ? ' is-large' : ''));\n\t\tnode.setAttribute('aria-hidden', true);\n\t\t_this.el.insertAdjacentElement('afterend', node);\n\n\t\treturn node;\n\t}\n\n\t/**\n\t * Assemble the html containing each appointment represented by a button\n\t * @param {Object} opt - options object\n\t * @param {Array} intervals - array holding interval permutations\n\t * @param {Array} disabledArr - array holding disabled times\n\t */\n\tfunction _assemblePicker(opt, intervals, disabledArr) {\n\t\t// _this.options, _this.intervals, _this.disabledArr\n\t\tvar start = opt.startTime;\n\t\tvar end = opt.endTime;\n\t\tvar inner = '';\n\t\tvar isAmPmMode = opt.mode === '12h';\n\t\tvar timePattern = isAmPmMode ? opt.timeFormat12 : opt.timeFormat24;\n\n\t\tfor (var hour = start; hour < end; hour++) { // Iterate hours start to end\n\t\t\tfor (var j = 0; j < intervals.length; j++) { // Iterate minutes by possible intervals\n\t\t\t\tvar minute = intervals[j];\n\t\t\t\tvar isDisabled = !_isValid(hour, minute, opt, intervals, disabledArr);\n\t\t\t\tvar timeFormat = _printTime(hour, minute, timePattern, isAmPmMode, opt.leadingZero);\n\t\t\t\t// Replace timeFormat placeholders with time and disabled flag\n\t\t\t\tinner += opt.templateInner\n\t\t\t\t\t.replace('{{time}}', timeFormat)\n\t\t\t\t\t.replace(/{{disabled}}/ig, isDisabled ? 'disabled': '');\n\t\t\t}\n\t\t}\n\n\t\treturn opt.templateOuter\n\t\t\t.replace('{{classes}}', opt.large ? 'is-large': '')\n\t\t\t.replace('{{title}}', opt.title)\n\t\t\t.replace('{{innerHtml}}', inner);\n\t}\n\n\t/**\n\t * Creates and triggers an event with attached time property\n\t * @param {HTMLElement} el - element reference\n\t * @param {String} name - event name\n\t * @param {Object} time - current time\n\t */\n\tfunction _dispatchEvent(el, name, time, displayTime) {\n\t\tvar event = document.createEvent('Event');\n\t\tevent.initEvent(name + '.appo.picker', true, true);\n\t\tevent.time = time;\n\t\tevent.displayTime = displayTime;\n\t\tel.dispatchEvent(event);\n\t}\n\n\treturn AppointmentPicker;\n}));\n"]},"metadata":{},"sourceType":"script"}